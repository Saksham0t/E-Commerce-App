<div class="container py-4">
  <h3 class="mb-4">ðŸ“¦ Manage Orders</h3>

  <!-- Search Bar -->
  <input type="text" class="form-control mb-3" placeholder="Search by Order ID or Customer Name"
         [(ngModel)]="searchTerm">

  <!-- Orders Table -->
  <table class="table table-bordered text-center table-hover">
    <thead class="table-light">
      <tr>
        <th>Order ID</th>
        <th>Customer</th>
        <th>Current Order Status</th>
        <th>Current Payment Status</th>
        <th>Change Status</th>
        <th>Total Price</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <ng-container *ngFor="let order of getFilteredOrders(); trackBy: trackByOrderId" >
      <tr>
        <td>{{ order.id }}</td>
        <td>{{ getCustomerName(order.userId) }}</td>
        <td><span class="badge">{{ order.orderStatus }}</span></td>
        <td>
          <select id="statusSelect-{{ order.id }}"
                  class="form-select form-select-sm-w-auto"
                  [(ngModel)]="order.orderStatus"
                  (change)="updateOrderStatus(order.id, order.orderStatus)">
            <option disabled selected>-- Change Status --</option>
            <option value="Processing">Processing</option>
            <option value="Shipped">Shipped</option>
            <option value="Delivered">Delivered</option>
            <option value="Cancelled">Cancelled</option>
          </select>
        </td>
        <td><span class="badge">{{ order.paymentStatus }}</span></td>
        <td>â‚¹{{ order.totalPrice }}</td>
        <td>
          <button class=".btn"
                  (click)="toggleDetails(order.id)">
            {{ selectedOrderId === order.id ? 'Hide Details' : 'View Details' }}
          </button>
        </td>
      </tr>

      <!-- Product Details Row -->
      <tr *ngIf="selectedOrderId === order.id">
  <td colspan="7" class="bg-light">
  <div class="p-3 border rounded shadow-sm">
    <h6 class="mb-3 text-primary">ðŸ›’ Products in Order #{{ order.id }}</h6>

    <div class="row g-3">
      <div *ngFor="let p of order.products" class="col-md-6">
        <div class="d-flex align-items-center border rounded p-2 bg-white">
          <img [src]="getProductDetails(p.id).imageUrl"
               alt="Product Image"
               width="60"
               class="me-3 rounded border">
          <div>
            <h6 class="mb-1">{{ getProductDetails(p.id).name }}</h6>
            <small class="text-muted d-block">Quantity: {{ p.quantity }}</small>
            <small class="text-muted d-block">Price: â‚¹{{ (getProductDetails(p.id)?.price || 0) * p.quantity }}</small>
          </div>
        </div>
      </div>
    </div>

    <hr class="my-3">

    <!-- Payment Status Section -->
    <div class="d-flex align-items-center justify-content-between flex-wrap">
      <p class="mb-2 mb-md-0">
        <strong class="text-dark">ðŸ’³ Payment Status:</strong>
        <span class="badge bg-secondary ms-2">{{ order.paymentStatus }}</span>
      </p>

      <div class="d-flex align-items-center gap-2">
        <label for="statusSelect-{{ order.id }}" class="form-label mb-0 fw-semibold text-muted">
          Change Payment Status:
        </label>
        <select id="statusSelect-{{ order.id }}"
                class="form-select form-select-sm w-auto"
                [(ngModel)]="order.paymentStatus"
                (change)="updateOrderPaymentStatus(order.id, order.paymentStatus)">
          <option disabled value="">-- Select Method --</option>
          <option value="Done: Paid by UPI">UPI</option>
          <option value="Done: Paid by Debit/Credit Card">Debit/Credit Card</option>
          <option value="Done: Paid by Cash on Delivery">Cash on Delivery</option>
          <option value="Done: Paid by Net Banking">Net Banking</option>
        </select>
      </div>
    </div>
  </div>
</td>

</tr>

    </ng-container>
    </tbody>
  </table>
</div>