<div class="container py-4">
  <h3 class="mb-4">ðŸ“¦ Manage Orders</h3>

  <!-- Search Bar -->
  <input type="text" class="form-control mb-3" placeholder="Search by Order ID or Customer Name"
         [(ngModel)]="searchTerm">

  <!-- Orders Table -->
  <table class="table table-bordered table-hover">
    <thead class="table-light">
      <tr>
        <th>Order ID</th>
        <th>Customer</th>
        <th>Current Status</th>
        <th>Change Status</th>
        <th>Total Price</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <ng-container *ngFor="let order of getFilteredOrders()">
      <tr>
        <td>{{ order.id }}</td>
        <td>{{ getCustomerName(order.userId) }}</td>
        <td><span class="badge bg-info text-dark">{{ order.orderStatus }}</span></td>
        <td>
          <select id="statusSelect-{{ order.id }}"
                  class="form-select form-select-sm"
                  (change)="updateOrderStatus(order.id, $event)">
            <option disabled selected>-- Change Status --</option>
            <option>Processing</option>
            <option>Shipped</option>
            <option>Delivered</option>
            <option>Cancelled</option>
          </select>
        </td>
        <td>â‚¹{{ order.totalPrice }}</td>
        <td>
          <button class="btn btn-outline-primary btn-sm"
                  (click)="toggleDetails(order.id)">
            {{ selectedOrderId === order.id ? 'Hide Details' : 'View Details' }}
          </button>
        </td>
      </tr>

      <!-- Product Details Row -->
      <tr *ngIf="selectedOrderId === order.id">
  <td colspan="6" class="bg-light">
    <div class="p-3 border rounded shadow-sm">
      <h6 class="mb-3 text-primary">ðŸ›’ Products in Order #{{ order.id }}</h6>

      <div class="row g-3">
        <div *ngFor="let p of order.products" class="col-md-6">
          <div class="d-flex align-items-center border rounded p-2 bg-white">
            <img [src]="getProductDetails(p.id).ImageURL"
                 alt="Product Image"
                 width="60"
                 class="me-3 rounded border">
            <div>
              <h6 class="mb-1">{{ getProductDetails(p.id).name }}</h6>
              <small class="text-muted">Quantity: {{ p.quantity }}</small><br>
              <small class="text-muted">Price: â‚¹{{ getProductDetails(p.id)?.Price }}</small>
            </div>
          </div>
        </div>
      </div>

      <hr class="my-3">
      <p class="mb-0"><strong>ðŸ’³ Payment Status:</strong> {{ order.paymentStatus }}</p>
    </div>
  </td>
</tr>

    </ng-container>
    </tbody>
  </table>
</div>
