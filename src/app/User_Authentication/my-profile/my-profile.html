<div class="container my-5" *ngIf="!isLoading">
  <div class="row">
    <!-- Sidebar -->
    <div class="col-md-3 mb-4">
      <div class="list-group shadow-sm">
        <a class="list-group-item" [class.active]="activeTab==='profile'" (click)="setTab('profile')">Profile Info</a>
        <a class="list-group-item" [class.active]="activeTab==='orders'" (click)="setTab('orders')">My Orders</a>
        <a class="list-group-item" [class.active]="activeTab==='settings'" (click)="setTab('settings')">Settings</a>
      </div>
    </div>

    <!-- Main Content -->
    <div class="col-md-9">
      <!-- Profile Info -->
      <div *ngIf="activeTab==='profile'" class="card mb-4">
        <div class="card-header bg-primary text-white">Profile Information</div>
        <div class="card-body">
          <p><strong>Name:</strong> {{ user.Name }}</p>
          <p><strong>Email:</strong> {{ user.Email }}</p>
          <p><strong>Shipping Address:</strong> {{ user.ShippingAddress }}</p>
          <p><strong>Payment Details:</strong> {{ user.PaymentDetails }}</p>
        </div>
      </div>

      <!-- Orders -->
      <div *ngIf="activeTab==='orders'" class="card mb-4">
        <div class="card-header bg-secondary text-white">My Orders</div>
        <div class="card-body">
          <table class="table table-bordered text-center" *ngIf="orders.length; else noOrders">
            <thead class="table-primary">
              <tr>
                <th>#</th><th>Products</th><th>Total</th><th>Date</th>
                <th>Address</th><th>Status</th><th>Payment</th><th></th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let o of orders">
                <td>#{{ o.id }}</td>
                <td>{{ o.products.length }}</td>
                <td>₹{{ o.totalPrice }}</td>
                <td>{{ o.orderDate }}</td>
                <td>{{ o.ShippingAddress }}</td>
                <td>{{ o.orderStatus }}</td>
                <td>{{ o.paymentStatus }}</td>
                <td>
                  <button class="btn btn-sm btn-outline-primary" (click)="viewOrderDetails(o)">
                    {{ selectedOrder?.id===o.id ? 'Hide' : 'Details' }}
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
          <ng-template #noOrders><p>No orders found.</p></ng-template>

          <div *ngIf="selectedOrder" class="card mt-3">
            <div class="card-header bg-dark text-white">Order #{{ selectedOrder.id }} Details</div>
            <div class="card-body">
              <p><strong>Address:</strong> {{ selectedOrder.ShippingAddress }}</p>
              <p><strong>Date:</strong> {{ selectedOrder.orderDate }}</p>
              <p><strong>Status:</strong> {{ selectedOrder.orderStatus }}</p>
              <p><strong>Payment:</strong> {{ selectedOrder.paymentStatus }}</p>
              <ul class="list-group">
                <li class="list-group-item" *ngFor="let p of selectedOrder.products">
                  {{ getProductDetails(p.id)?.name }} × {{ p.quantity }}
                  (₹{{ getProductDetails(p.id)?.Price }})
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- Settings -->
      <div *ngIf="activeTab==='settings'" class="card">
        <div class="card-header bg-dark text-white">Account Settings</div>
        <div class="card-body">
          <button class="btn btn-outline-secondary me-2" (click)="updateField('Password','Password')">Change Password</button>
          <button class="btn btn-outline-secondary me-2" (click)="updateField('ShippingAddress','Shipping Address')">Update Address</button>
          <button class="btn btn-outline-secondary me-2" (click)="updateField('PaymentDetails','Payment Details')">Update Payment</button>
          <button class="btn btn-danger" (click)="logout()">Logout</button>
        </div>
      </div>
    </div>
  </div>
</div>
